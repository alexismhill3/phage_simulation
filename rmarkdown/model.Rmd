---
title: "Model of translational coupling"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The new new model

To model the effects of translational coupling on protein production, we first assume a polycistronic transcript with two genes $a$, $b$, and $c$. For the effective initiation rate of $a_\text{in}$ we define the following relationship
$$a_\text{in} = \min\left\{i_a, \tau_a\right\}$$
where $i_a$ is the aggregate initiation rate of $a$ and $\tau_a$ is the translation elongation rate of gene $a$. We assume that if the initiation rate ever exceeds the elongation rate, ribosomes would quickly back up on the transcript and make elongation the rate-limiting step of translation. Thus in our model, the elongation rate can never be exceed by the aggregate translation initiation rate. For gene $a$, the aggregate initiation rate is simply the _de novo_ initiation rate because there are no genes upstream of $a$.

The rate at which ribosomes complete translation of gene $a$, or protein production rate of A, is defined as

$$ \dot{A} = a_\text{in} $$
at steady state.

For the effective translation initiation rate $b_\text{in}$ of gene $b$, we define the following relationship
$$b_\text{in} = \min\left\{i_b, \tau_b\right\}$$

where $\tau_b$ is the translation elongation rate of $b$ and $i_b$ is the aggregate translation initiation rate due to upstream-dependent reinitiation and \textit{de novo} initiation. We define the aggregate translation initiation rate
$$i_b = b_\text{reinit} + b_\text{de novo}$$
where $b_\text{reinit}$ is the rate of upstream translating ribosomes reinitiating on gene $b$ and $b_\text{de novo}$ is the rate of ribosomes initiating \textit{de novo} on gene $b$.

Lastly we define reinitiation and \textit{de novo} initiation rates on gene $b$ as follows

$$b_\text{reinit} = q_b\dot{A}$$
$$b_\text{de novo} = z_b\dot{A} + w_b$$
Where $\dot{A}$ is the rate of ribosomes flowing from the end of upstream gene $a$, and $q_b$ represents the proportion of that ribosome flow reinitiating on gene $b$. We assume that the rate of \textit{de novo} initation depends, in part, on upstream ribosomes relaxing secondary structure around the ribosome binding site of gene $b$. Thus, the rate of \textit{de novo} initiation is given the upstream ribosome flow $\dot{A}$ scaled by some constant $z_b$, and \textit{de novo} initiation rate $w_b$ that does not depend on upstream ribosome flow.

We can simplify the effective initiation rate to
$$b_\text{in} = \min\left\{q_b\dot{A} + z_b\dot{A} + w_b, \tau_b\right\}$$

Similar to the protein production rate of gene A, we define the protein production of gene B 

$$ \dot{B} = b_\text{in} $$

at steady state.

The effective initiation rate of gene $c$ is similar to that of gene $a$

$$c_\text{in} = \min\left\{q_c\dot{B} + z_c\dot{B} + w_c, \tau_c\right\}$$

where $\dot{B}$ is the rate of ribosomes flowing from the end of upstream gene $b$, and $q_c$ represents the proportion of that ribosome flow reinitiating on gene $c$. The rate of _de novo_ initiation dependent on upstream ribosome flow is given by $z_c$, and $w_c$ is the _de novo_ initation rate independent of upstream ribosome flow. 

### Plots

I have made plots similar to Fig 7 in our paper over a range of $z$ and $q$ values at steady state. A few cases to note:

* $q = 0$, top row. Since $q = 0$, any upstream-dependent initiation events are due to facilitated binding. Changing $z$ does not affect protein production of C at all because at steady state, all RBSes should be exposed by upstream ribosomes, and facilitated binding events will be indistinguishible from _de novo_ initiation.

* $z = 0$, left-most column. Since $z = 0$, there is no translational coupling. All initiation events occur independently.

So, at steady state, the system behaves the same if either $q = 0$ or $z = 0$. I think this makes sense biologically.

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=10, fig.height=8}
library(dplyr)
library(tidyr)
library(ggplot2)
library(cowplot)

k <- 3
tau_1 <- 3.5
tau_3 <- 3.5

a_in <- function() min(k, tau_1)
a_dot <- function() a_in()
# These functions produce a non-linear curve because we vary tau_2, which is in the denominator
b_in <- function(tau_2, z, q, w) min(a_dot()*(z + q) + w, tau_2)
b_dot <- function(tau_2, z, q, w) b_in(tau_2, z, q, w)
c_in <- function(tau_2, z, q, w) min(b_dot(tau_2, z, q, w)*(z + q) + w, tau_3)
c_dot <- function(tau_2, z, q, w) c_in(tau_2, z, q, w)

taus <- seq(0, 8, 0.01)

w <- 0

make_df <- function(z, q) {
  data.frame(rate_B = taus,
             A = a_dot(),
             B = sapply(taus, b_dot, z, q, w),
             C = sapply(taus, c_dot, z, q, w),
             z = z,
             q = q)
}

z_vals <- list(0, 0.25, 0.5, 0.75, 1)
q_vals <- list(0, 0.25, 0.5, 0.75, 1)

df <- purrr::cross_d(list(z_vals = z_vals, q_vals = q_vals)) %>% 
  mutate(data = purrr::map2(z_vals, q_vals, make_df)) %>% unnest()
df <- gather(df, protein, rate, A:C)

plot <- ggplot(df, aes(x = rate_B, y = rate, color = protein)) +
  geom_line() +
  facet_grid(q_vals~z_vals, labeller = label_both) +
  panel_border() +
  xlab("translate elongation rate of protein B (s)") +
  ylab("rate of protein production") +
  scale_x_continuous(trans="reverse")

plot
```
